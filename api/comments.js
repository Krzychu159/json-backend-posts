let comments = [
  {
    postId: 1,
    id: 1,
    name: "Rachel Moore",
    email: "rachel.moore@example.com",
    body: "Nice post! Really enjoyed it.",
  },
  {
    postId: 1,
    id: 2,
    name: "Steven Brooks",
    email: "steven.brooks@example.com",
    body: "Great read. Thanks!",
  },
  {
    postId: 1,
    id: 3,
    name: "Ashley Miller",
    email: "ashley.miller@example.com",
    body: "Helpful and straight to the point.",
  },
  {
    postId: 1,
    id: 4,
    name: "Kevin Reed",
    email: "kevin.reed@example.com",
    body: "Good explanation. Loved it.",
  },

  {
    postId: 2,
    id: 5,
    name: "Laura Adams",
    email: "laura.adams@example.com",
    body: "Very useful content.",
  },
  {
    postId: 2,
    id: 6,
    name: "Daniel Foster",
    email: "daniel.foster@example.com",
    body: "I really liked this!",
  },
  {
    postId: 2,
    id: 7,
    name: "Megan Hill",
    email: "megan.hill@example.com",
    body: "Thanks for the tips!",
  },

  {
    postId: 3,
    id: 8,
    name: "Tyler Harris",
    email: "tyler.harris@example.com",
    body: "Super clear and helpful.",
  },
  {
    postId: 3,
    id: 9,
    name: "Emily Price",
    email: "emily.price@example.com",
    body: "Thanks for sharing!",
  },
  {
    postId: 3,
    id: 10,
    name: "Aaron Morgan",
    email: "aaron.morgan@example.com",
    body: "Really good info here.",
  },
  {
    postId: 3,
    id: 11,
    name: "Sara Ross",
    email: "sara.ross@example.com",
    body: "Clear and concise.",
  },

  {
    postId: 4,
    id: 12,
    name: "Brian Scott",
    email: "brian.scott@example.com",
    body: "Loved this one!",
  },
  {
    postId: 4,
    id: 13,
    name: "Olivia James",
    email: "olivia.james@example.com",
    body: "Awesome tips, thanks!",
  },
  {
    postId: 4,
    id: 14,
    name: "Zachary Long",
    email: "zachary.long@example.com",
    body: "That helped a lot.",
  },

  {
    postId: 5,
    id: 15,
    name: "Chloe Sanders",
    email: "chloe.sanders@example.com",
    body: "Very helpful post!",
  },
  {
    postId: 5,
    id: 16,
    name: "Justin Perry",
    email: "justin.perry@example.com",
    body: "Appreciate the info!",
  },
  {
    postId: 5,
    id: 17,
    name: "Diana Mitchell",
    email: "diana.mitchell@example.com",
    body: "Short and useful!",
  },
  {
    postId: 5,
    id: 18,
    name: "Henry Gray",
    email: "henry.gray@example.com",
    body: "Nice summary!",
  },
  {
    postId: 5,
    id: 19,
    name: "Sophia Rivera",
    email: "sophia.rivera@example.com",
    body: "Just what I needed.",
  },

  {
    postId: 6,
    id: 20,
    name: "Ethan Howard",
    email: "ethan.howard@example.com",
    body: "Thanks, this was great.",
  },
  {
    postId: 6,
    id: 21,
    name: "Natalie Jenkins",
    email: "natalie.jenkins@example.com",
    body: "Very clear writing.",
  },
  {
    postId: 6,
    id: 22,
    name: "Jack Turner",
    email: "jack.turner@example.com",
    body: "Made it simple!",
  },

  {
    postId: 7,
    id: 23,
    name: "Grace Simmons",
    email: "grace.simmons@example.com",
    body: "Awesome breakdown!",
  },
  {
    postId: 7,
    id: 24,
    name: "Logan Barnes",
    email: "logan.barnes@example.com",
    body: "Solid post.",
  },
  {
    postId: 7,
    id: 25,
    name: "Amanda Kelly",
    email: "amanda.kelly@example.com",
    body: "Good points, thanks!",
  },
  {
    postId: 7,
    id: 26,
    name: "Sean Patterson",
    email: "sean.patterson@example.com",
    body: "Very informative.",
  },

  {
    postId: 8,
    id: 27,
    name: "Victoria Ward",
    email: "victoria.ward@example.com",
    body: "I learned a lot.",
  },
  {
    postId: 8,
    id: 28,
    name: "Brandon Hayes",
    email: "brandon.hayes@example.com",
    body: "Really helpful guide.",
  },
  {
    postId: 8,
    id: 29,
    name: "Nicole Bailey",
    email: "nicole.bailey@example.com",
    body: "Thanks for writing this!",
  },
  {
    postId: 8,
    id: 30,
    name: "Benjamin Cox",
    email: "benjamin.cox@example.com",
    body: "Helpful and simple.",
  },
  {
    postId: 8,
    id: 31,
    name: "Julia Bell",
    email: "julia.bell@example.com",
    body: "Appreciate it!",
  },

  {
    postId: 9,
    id: 32,
    name: "Adam Hughes",
    email: "adam.hughes@example.com",
    body: "Well explained.",
  },
  {
    postId: 9,
    id: 33,
    name: "Samantha Cooper",
    email: "samantha.cooper@example.com",
    body: "Great stuff!",
  },
  {
    postId: 9,
    id: 34,
    name: "Matthew Murphy",
    email: "matthew.murphy@example.com",
    body: "Thanks a lot!",
  },
  {
    postId: 9,
    id: 35,
    name: "Hailey Richardson",
    email: "hailey.richardson@example.com",
    body: "Exactly what I needed.",
  },

  {
    postId: 10,
    id: 36,
    name: "Nathan Bell",
    email: "nathan.bell@example.com",
    body: "So helpful, thanks!",
  },
  {
    postId: 10,
    id: 37,
    name: "Isabella Watson",
    email: "isabella.watson@example.com",
    body: "Good job on this.",
  },
  {
    postId: 10,
    id: 38,
    name: "Liam Barnes",
    email: "liam.barnes@example.com",
    body: "Really nice article.",
  },

  {
    postId: 11,
    id: 39,
    name: "Abigail Powell",
    email: "abigail.powell@example.com",
    body: "This helped a bunch.",
  },
  {
    postId: 11,
    id: 40,
    name: "Christopher James",
    email: "christopher.james@example.com",
    body: "Super useful.",
  },
  {
    postId: 11,
    id: 41,
    name: "Ella Martinez",
    email: "ella.martinez@example.com",
    body: "Quick and effective.",
  },

  {
    postId: 12,
    id: 42,
    name: "Owen Bryant",
    email: "owen.bryant@example.com",
    body: "Excellent info.",
  },
  {
    postId: 12,
    id: 43,
    name: "Lily Ross",
    email: "lily.ross@example.com",
    body: "Thanks for posting!",
  },
  {
    postId: 12,
    id: 44,
    name: "Caleb Griffin",
    email: "caleb.griffin@example.com",
    body: "Neatly explained.",
  },
  {
    postId: 12,
    id: 45,
    name: "Avery Bennett",
    email: "avery.bennett@example.com",
    body: "That was great!",
  },
];

export default function handler(req, res) {
  // === CORS HEADERS ===
  res.setHeader("Access-Control-Allow-Origin", "*");
  res.setHeader(
    "Access-Control-Allow-Methods",
    "GET, POST, PUT, DELETE, OPTIONS"
  );
  res.setHeader("Access-Control-Allow-Headers", "Content-Type");

  if (req.method === "OPTIONS") {
    return res.status(200).end();
  }
  // ======================

  const { method, url } = req;
  const match = url.match(/\/api\/comments\/?(\d+)?/);
  const id = match?.[1] ? parseInt(match[1]) : null;

  if (method === "GET") {
    if (id) {
      const comment = comments.find((c) => c.id === id);
      return comment
        ? res.status(200).json(comment)
        : res.status(404).json({ message: "Comment not found" });
    }
    return res.status(200).json(comments);
  }

  if (method === "POST") {
    const newComment = req.body;
    newComment.id = comments.length
      ? Math.max(...comments.map((c) => c.id)) + 1
      : 1;
    comments.push(newComment);
    return res.status(201).json(newComment);
  }

  if (method === "PUT") {
    if (!id) return res.status(400).json({ message: "Missing comment ID" });
    const index = comments.findIndex((c) => c.id === id);
    if (index === -1)
      return res.status(404).json({ message: "Comment not found" });
    comments[index] = { ...comments[index], ...req.body };
    return res.status(200).json(comments[index]);
  }

  if (method === "DELETE") {
    if (!id) return res.status(400).json({ message: "Missing comment ID" });
    const index = comments.findIndex((c) => c.id === id);
    if (index === -1)
      return res.status(404).json({ message: "Comment not found" });
    comments.splice(index, 1);
    return res.status(204).end();
  }

  return res.status(405).json({ message: "Method not allowed" });
}
